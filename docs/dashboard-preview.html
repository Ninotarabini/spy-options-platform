<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPY 0DTE Monitor - IBKR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Language Toggle - Below header */
        .lang-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .lang-toggle-inner {
            display: flex;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 5px;
            border: 2px solid rgba(0, 212, 255, 0.3);
        }
        
        .lang-btn {
            padding: 8px 20px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 20px;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .lang-btn.active {
            background: #00d4ff;
            color: #000;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
        }
        
        .lang-btn:hover:not(.active) {
            color: #fff;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .spy-price {
            font-size: 32px;
            font-weight: bold;
            color: #00ff88;
            display: inline-block;
            margin-right: 15px;
        }
        
        .price-change {
            font-size: 18px;
            font-weight: bold;
            display: inline-block;
            padding: 5px 12px;
            border-radius: 5px;
        }
        
        .price-change.positive {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.15);
        }
        
        .price-change.negative {
            color: #ff0064;
            background: rgba(255, 0, 100, 0.15);
        }
        
        .spy-info {
            display: flex;
            align-items: center;
        }
        
        .range-info {
            text-align: right;
        }
        
        .range-info div {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .range-value {
            color: #00d4ff;
            font-weight: bold;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            background: #00ff88;
            color: #000;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .main-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #00d4ff;
            border-bottom: 2px solid #00d4ff;
            padding-bottom: 10px;
            text-align: center;
        }
        
        .options-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .options-table th {
            background: rgba(0, 212, 255, 0.1);
            padding: 12px 8px;
            text-align: center;
            font-size: 11px;
            color: #00d4ff;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .options-table td {
            padding: 15px 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 13px;
            text-align: center;
        }
        
        .options-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        .strike-cell {
            font-weight: bold;
            font-size: 16px;
            background: rgba(0, 212, 255, 0.15);
            color: #00d4ff;
        }
        
        .atm-row {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88 !important;
        }
        
        .atm-row .strike-cell {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            font-size: 18px;
        }
        
        .call-section {
            background: rgba(0, 255, 136, 0.05);
        }
        
        .put-section {
            background: rgba(255, 100, 100, 0.05);
        }
        
        .volume-bar-container {
            display: flex;
            gap: 3px;
            align-items: center;
            height: 30px;
        }
        
        .volume-bar {
            height: 100%;
            border-radius: 3px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: #000;
        }
        
        .bid-bar {
            background: linear-gradient(90deg, #00ff88, #00d4ff);
        }
        
        .ask-bar {
            background: linear-gradient(90deg, #ff6b9d, #ff0064);
        }
        
        .volume-split {
            display: flex;
            gap: 5px;
            font-size: 11px;
        }
        
        .bid-volume {
            color: #00ff88;
        }
        
        .ask-volume {
            color: #ff6b9d;
        }
        
        .anomaly {
            background: rgba(255, 0, 100, 0.2) !important;
            border-left: 4px solid #ff0064;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { background: rgba(255, 0, 100, 0.2); }
            50% { background: rgba(255, 0, 100, 0.4); }
        }
        
        .alert-badge {
            display: inline-block;
            padding: 3px 8px;
            background: #ff0064;
            color: #fff;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .price-positive {
            color: #00ff88;
        }
        
        .price-negative {
            color: #ff0064;
        }
        
        .alert-item {
            background: rgba(255, 0, 100, 0.1);
            border-left: 4px solid #ff0064;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .alert-time {
            color: #888;
            font-size: 12px;
        }
        
        .chart-panel {
            margin-top: 0;
        }
        
        .chart-wrapper {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            position: relative;
        }
        
        #volumeChart {
            width: 100%;
            height: 350px;
            border-radius: 5px;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 13px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 30px;
            height: 3px;
            border-radius: 2px;
        }
        
        .legend-calls {
            background: #00ff88;
        }
        
        .legend-puts {
            background: #ff0064;
        }
        
        .legend-spy {
            background: #ffd700;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Language Toggle -->
        <div class="lang-toggle">
            <div class="lang-toggle-inner">
                <button class="lang-btn active" onclick="switchLanguage('en')" id="btn-en">üá¨üáß EN</button>
                <button class="lang-btn" onclick="switchLanguage('es')" id="btn-es">üá™üá∏ ES</button>
            </div>
        </div>
        
        <div class="header">
            <div>
                <div style="font-size: 12px; color: #888; margin-bottom: 5px;" data-i18n="spyCurrentPrice">SPY Current Price</div>
                <div class="spy-info">
                    <div class="spy-price">$684.23</div>
                    <div class="price-change positive">+0.45%</div>
                </div>
                <div style="margin-top: 8px;">
                    <span class="status" data-i18n="statusLive">‚óè LIVE - IBKR Connected</span>
                </div>
            </div>
            <div class="range-info">
                <div><span data-i18n="monitoredRange">Monitored Range</span>: <span class="range-value">¬±1%</span></div>
                <div><span data-i18n="maxStrike">Max Strike</span>: <span class="range-value">$690.87</span></div>
                <div><span data-i18n="minStrike">Min Strike</span>: <span class="range-value">$677.59</span></div>
                <div style="margin-top: 8px; color: #888; font-size: 12px;"><span data-i18n="updateFreq">Update: Every 2sec</span></div>
            </div>
        </div>
        
        <div class="main-grid">
            <!-- Gr√°fico Temporal -->
            <div class="panel">
                <div class="panel-title" data-i18n="chartTitle">üìä Real-Time Cumulative Volume (Last 2 Hours)</div>
                <div class="chart-panel">
                    <div class="chart-wrapper">
                        <canvas id="volumeChart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color legend-calls"></div>
                            <span data-i18n="volumeCalls">CALLs Volume</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-puts"></div>
                            <span data-i18n="volumePuts">PUTs Volume</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-spy"></div>
                            <span data-i18n="spyPrice">SPY Price ($684.23)</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Alertas y Anomal√≠as -->
            <div class="panel">
                <div class="panel-title" data-i18n="alertsTitle">üö® Detected Anomaly Alerts</div>
                <div class="alert-item">
                    <div>
                        <strong>CALL $591.00</strong> - <span data-i18n="alert1">83% price drop vs previous strike ($2.65 ‚Üí $0.45)</span>
                        <div style="margin-top: 5px; font-size: 12px; color: #888;">
                            üî¥ <span data-i18n="alert1Detail">Wide bid-ask spread detected | Abnormal Bid/Ask ratio (32%/68%)</span>
                        </div>
                    </div>
                    <div class="alert-time">14:32:18</div>
                </div>
                <div class="alert-item">
                    <div>
                        <strong>ATM Strike $587.00</strong> - <span data-i18n="alert2">Strong buying pressure on CALLs (56% bid) vs selling pressure on PUTs (56% ask)</span>
                        <div style="margin-top: 5px; font-size: 12px; color: #888;">
                            üü¢ <span data-i18n="alert2Detail">Possible institutional bullish sentiment</span>
                        </div>
                    </div>
                    <div class="alert-time">14:28:45</div>
                </div>
                <div class="alert-item">
                    <div>
                        <strong>PUT $591.00</strong> - <span data-i18n="alert3">Unusually high ask volume (62%) indicating aggressive put selling</span>
                        <div style="margin-top: 5px; font-size: 12px; color: #888;">
                            ‚ö† <span data-i18n="alert3Detail">Possible protection sale or covered puts strategy</span>
                        </div>
                    </div>
                    <div class="alert-time">14:25:12</div>
                </div>
            </div>
            
            <!-- Vista Confrontada -->
            <div class="panel">
                <div class="panel-title" data-i18n="confrontedView">üìä CONFRONTED VIEW - 7 Strikes Around ATM</div>
                <table class="options-table">
                    <thead>
                        <tr>
                            <th colspan="5" style="background: rgba(0, 255, 136, 0.1);">üìà CALLS</th>
                            <th style="background: rgba(0, 212, 255, 0.2);">STRIKE</th>
                            <th colspan="5" style="background: rgba(255, 100, 100, 0.1);">üìâ PUTS</th>
                        </tr>
                        <tr>
                            <th class="call-section" data-i18n="price">Price</th>
                            <th class="call-section" data-i18n="totalVol">Total Vol</th>
                            <th class="call-section" data-i18n="bidVol">Bid Vol</th>
                            <th class="call-section" data-i18n="askVol">Ask Vol</th>
                            <th class="call-section" data-i18n="flowVisual">Flow Visual</th>
                            <th style="background: rgba(0, 212, 255, 0.2);">$</th>
                            <th class="put-section" data-i18n="flowVisual">Flow Visual</th>
                            <th class="put-section" data-i18n="bidVol">Bid Vol</th>
                            <th class="put-section" data-i18n="askVol">Ask Vol</th>
                            <th class="put-section" data-i18n="totalVol">Total Vol</th>
                            <th class="put-section" data-i18n="price">Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Strike -3 -->
                        <tr>
                            <td class="call-section price-positive">$11.25</td>
                            <td class="call-section">8,240</td>
                            <td class="call-section bid-volume">5,820</td>
                            <td class="call-section ask-volume">2,420</td>
                            <td class="call-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 71%;">71%</div>
                                    <div class="ask-bar volume-bar" style="width: 29%;">29%</div>
                                </div>
                            </td>
                            <td class="strike-cell">$581.00</td>
                            <td class="put-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 45%;">45%</div>
                                    <div class="ask-bar volume-bar" style="width: 55%;">55%</div>
                                </div>
                            </td>
                            <td class="put-section bid-volume">2,340</td>
                            <td class="put-section ask-volume">2,860</td>
                            <td class="put-section">5,200</td>
                            <td class="put-section price-negative">$0.65</td>
                        </tr>
                        
                        <!-- Strike -2 -->
                        <tr>
                            <td class="call-section price-positive">$8.90</td>
                            <td class="call-section">12,680</td>
                            <td class="call-section bid-volume">7,450</td>
                            <td class="call-section ask-volume">5,230</td>
                            <td class="call-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 59%;">59%</div>
                                    <div class="ask-bar volume-bar" style="width: 41%;">41%</div>
                                </div>
                            </td>
                            <td class="strike-cell">$583.00</td>
                            <td class="put-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 52%;">52%</div>
                                    <div class="ask-bar volume-bar" style="width: 48%;">48%</div>
                                </div>
                            </td>
                            <td class="put-section bid-volume">4,120</td>
                            <td class="put-section ask-volume">3,800</td>
                            <td class="put-section">7,920</td>
                            <td class="put-section price-negative">$1.35</td>
                        </tr>
                        
                        <!-- Strike -1 -->
                        <tr>
                            <td class="call-section price-positive">$6.45</td>
                            <td class="call-section">18,340</td>
                            <td class="call-section bid-volume">9,820</td>
                            <td class="call-section ask-volume">8,520</td>
                            <td class="call-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 54%;">54%</div>
                                    <div class="ask-bar volume-bar" style="width: 46%;">46%</div>
                                </div>
                            </td>
                            <td class="strike-cell">$585.00</td>
                            <td class="put-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 48%;">48%</div>
                                    <div class="ask-bar volume-bar" style="width: 52%;">52%</div>
                                </div>
                            </td>
                            <td class="put-section bid-volume">6,240</td>
                            <td class="put-section ask-volume">6,760</td>
                            <td class="put-section">13,000</td>
                            <td class="put-section price-negative">$2.80</td>
                        </tr>
                        
                        <!-- ATM Strike -->
                        <tr class="atm-row">
                            <td class="call-section price-positive"><strong>$4.15</strong></td>
                            <td class="call-section"><strong>24,560</strong></td>
                            <td class="call-section bid-volume"><strong>13,840</strong></td>
                            <td class="call-section ask-volume"><strong>10,720</strong></td>
                            <td class="call-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 56%;">56%</div>
                                    <div class="ask-bar volume-bar" style="width: 44%;">44%</div>
                                </div>
                            </td>
                            <td class="strike-cell">$587.00 <span style="font-size: 11px; color: #00ff88;">‚óè ATM</span></td>
                            <td class="put-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 44%;">44%</div>
                                    <div class="ask-bar volume-bar" style="width: 56%;">56%</div>
                                </div>
                            </td>
                            <td class="put-section bid-volume"><strong>8,120</strong></td>
                            <td class="put-section ask-volume"><strong>10,340</strong></td>
                            <td class="put-section"><strong>18,460</strong></td>
                            <td class="put-section price-negative"><strong>$4.35</strong></td>
                        </tr>
                        
                        <!-- Strike +1 -->
                        <tr>
                            <td class="call-section price-positive">$2.65</td>
                            <td class="call-section">15,820</td>
                            <td class="call-section bid-volume">7,240</td>
                            <td class="call-section ask-volume">8,580</td>
                            <td class="call-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 46%;">46%</div>
                                    <div class="ask-bar volume-bar" style="width: 54%;">54%</div>
                                </div>
                            </td>
                            <td class="strike-cell">$589.00</td>
                            <td class="put-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 51%;">51%</div>
                                    <div class="ask-bar volume-bar" style="width: 49%;">49%</div>
                                </div>
                            </td>
                            <td class="put-section bid-volume">7,140</td>
                            <td class="put-section ask-volume">6,860</td>
                            <td class="put-section">14,000</td>
                            <td class="put-section price-negative">$6.85</td>
                        </tr>
                        
                        <!-- Strike +2 - ANOMALY -->
                        <tr class="anomaly">
                            <td class="call-section price-positive">$0.45<span class="alert-badge">‚ö† ANOMALY</span></td>
                            <td class="call-section">4,220</td>
                            <td class="call-section bid-volume">1,340</td>
                            <td class="call-section ask-volume">2,880</td>
                            <td class="call-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 32%;">32%</div>
                                    <div class="ask-bar volume-bar" style="width: 68%;">68%</div>
                                </div>
                            </td>
                            <td class="strike-cell">$591.00</td>
                            <td class="put-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 38%;">38%</div>
                                    <div class="ask-bar volume-bar" style="width: 62%;">62%</div>
                                </div>
                            </td>
                            <td class="put-section bid-volume">3,240</td>
                            <td class="put-section ask-volume">5,280</td>
                            <td class="put-section">8,520</td>
                            <td class="put-section price-negative">$10.25</td>
                        </tr>
                        
                        <!-- Strike +3 -->
                        <tr>
                            <td class="call-section price-positive">$0.15</td>
                            <td class="call-section">2,480</td>
                            <td class="call-section bid-volume">890</td>
                            <td class="call-section ask-volume">1,590</td>
                            <td class="call-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 36%;">36%</div>
                                    <div class="ask-bar volume-bar" style="width: 64%;">64%</div>
                                </div>
                            </td>
                            <td class="strike-cell">$593.00</td>
                            <td class="put-section">
                                <div class="volume-bar-container">
                                    <div class="bid-bar volume-bar" style="width: 47%;">47%</div>
                                    <div class="ask-bar volume-bar" style="width: 53%;">53%</div>
                                </div>
                            </td>
                            <td class="put-section bid-volume">2,820</td>
                            <td class="put-section ask-volume">3,180</td>
                            <td class="put-section">6,000</td>
                            <td class="put-section price-negative">$14.50</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Internationalization
        const i18n = {
            en: {
                spyCurrentPrice: "SPY Current Price",
                statusLive: "‚óè LIVE - IBKR Connected",
                monitoredRange: "Monitored Range",
                maxStrike: "Max Strike",
                minStrike: "Min Strike",
                updateFreq: "Update: Every 2sec",
                chartTitle: "üìä Real-Time Cumulative Volume (Last 2 Hours)",
                volumeCalls: "CALLs Volume",
                volumePuts: "PUTs Volume",
                spyPrice: "SPY Price ($684.23)",
                alertsTitle: "üö® Detected Anomaly Alerts",
                alert1: "83% price drop vs previous strike ($2.65 ‚Üí $0.45)",
                alert1Detail: "Wide bid-ask spread detected | Abnormal Bid/Ask ratio (32%/68%)",
                alert2: "Strong buying pressure on CALLs (56% bid) vs selling pressure on PUTs (56% ask)",
                alert2Detail: "Possible institutional bullish sentiment",
                alert3: "Unusually high ask volume (62%) indicating aggressive put selling",
                alert3Detail: "Possible protection sale or covered puts strategy",
                confrontedView: "üìä CONFRONTED VIEW - 7 Strikes Around ATM",
                price: "Price",
                totalVol: "Total Vol",
                bidVol: "Bid Vol",
                askVol: "Ask Vol",
                flowVisual: "Flow Visual"
            },
            es: {
                spyCurrentPrice: "Precio Actual SPY",
                statusLive: "‚óè EN VIVO - IBKR Conectado",
                monitoredRange: "Rango Monitoreado",
                maxStrike: "Strike M√°ximo",
                minStrike: "Strike M√≠nimo",
                updateFreq: "Actualizaci√≥n: Cada 2seg",
                chartTitle: "üìä Volumen Acumulado en Tiempo Real (√öltimas 2 Horas)",
                volumeCalls: "Volumen CALLs",
                volumePuts: "Volumen PUTs",
                spyPrice: "Precio SPY ($684.23)",
                alertsTitle: "üö® Alertas de Anomal√≠as Detectadas",
                alert1: "Ca√≠da de precio del 83% respecto a strike anterior ($2.65 ‚Üí $0.45)",
                alert1Detail: "Spread bid-ask amplio detectado | Bid/Ask ratio anormal (32%/68%)",
                alert2: "Presi√≥n compradora fuerte en CALLs (56% bid) vs presi√≥n vendedora en PUTs (56% ask)",
                alert2Detail: "Posible sentimiento alcista institucional",
                alert3: "Volumen ask inusualmente alto (62%) indicando venta agresiva de puts",
                alert3Detail: "Posible venta de protecci√≥n o estrategia de covered puts",
                confrontedView: "üìä VISTA CONFRONTADA - 7 Strikes Alrededor del ATM",
                price: "Precio",
                totalVol: "Vol Total",
                bidVol: "Bid Vol",
                askVol: "Ask Vol",
                flowVisual: "Flow Visual"
            }
        };

        let currentLang = 'en';

        function switchLanguage(lang) {
            currentLang = lang;
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
            document.getElementById('btn-es').classList.toggle('active', lang === 'es');
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang][key]) {
                    el.textContent = i18n[lang][key];
                }
            });
            
            document.documentElement.lang = lang;
            localStorage.setItem('preferredLanguage', lang);
        }

        // Initialize language
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('preferredLanguage') || 'en';
            if (saved !== 'en') switchLanguage(saved);
            drawChart();
        });

        // Chart drawing code (ORIGINAL from spy-options-monitor_1.html)
        const timeLabels = [];
        const now = new Date();
        for (let i = 120; i >= 0; i--) {
            timeLabels.push(new Date(now - i * 60000));
        }

        const callVolumeHistory = Array.from({length: 121}, (_, i) => 1500000 + i * 30000 + Math.random() * 200000);
        const putVolumeHistory = Array.from({length: 121}, (_, i) => -1200000 - i * 25000 - Math.random() * 150000);
        const spyPriceHistory = Array.from({length: 121}, () => 684 + (Math.random() - 0.5) * 2);

        function formatTime(date) {
            return date.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false});
        }

        function drawChart() {
            const canvas = document.getElementById('volumeChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            const width = canvas.width;
            const height = canvas.height;
            const padding = 60;
            const paddingRight = 80;
            const chartHeight = height - 2 * padding;
            const chartWidth = width - padding - paddingRight;

            ctx.clearRect(0, 0, width, height);

            const maxCallVolume = Math.max(...callVolumeHistory);
            const minPutVolume = Math.min(...putVolumeHistory);
            const volumeRange = maxCallVolume - minPutVolume;
            const volumeScale = chartHeight / volumeRange;
            const zeroY = padding + (maxCallVolume * volumeScale);

            const maxSpyPrice = Math.max(...spyPriceHistory);
            const minSpyPrice = Math.min(...spyPriceHistory);
            const spyRange = maxSpyPrice - minSpyPrice;
            const spyScale = chartHeight / spyRange;

            // Grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - paddingRight, y);
                ctx.stroke();
                
                const volumeValue = maxCallVolume - (volumeRange / 5) * i;
                const volumeLabel = (volumeValue / 1000000).toFixed(0) + 'M';
                ctx.fillStyle = '#888';
                ctx.font = '10px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(volumeLabel, padding - 10, y + 4);
            }
            
            // SPY price labels (right)
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                const priceValue = maxSpyPrice - (spyRange / 5) * i;
                ctx.fillStyle = '#ffd700';
                ctx.font = '10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('$' + priceValue.toFixed(2), width - paddingRight + 10, y + 4);
            }
            
            // Zero line
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, zeroY);
            ctx.lineTo(width - paddingRight, zeroY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 10px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('0', padding - 10, zeroY + 4);
            
            // Axes
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - paddingRight, height - padding);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Time labels
            const timeStep = Math.floor(timeLabels.length / 8);
            for (let i = 0; i < timeLabels.length; i += timeStep) {
                const x = padding + (chartWidth / (timeLabels.length - 1)) * i;
                ctx.fillStyle = '#888';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(formatTime(timeLabels[i]), x, height - padding + 15);
            }
            
            function drawSmoothLine(data, color, lineWidth = 2.5, isPrice = false) {
                ctx.strokeStyle = color;
                ctx.lineWidth = lineWidth;
                ctx.beginPath();
                
                data.forEach((value, i) => {
                    const x = padding + (chartWidth / (data.length - 1)) * i;
                    let y;
                    
                    if (isPrice) {
                        y = padding + (maxSpyPrice - value) * spyScale;
                    } else {
                        y = padding + (maxCallVolume - value) * volumeScale;
                    }
                    
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.stroke();
                ctx.shadowBlur = 8;
                ctx.shadowColor = color;
                ctx.stroke();
                ctx.shadowBlur = 0;
            }
            
            drawSmoothLine(putVolumeHistory, '#ff0064', 2.5);
            drawSmoothLine(callVolumeHistory, '#00ff88', 2.5);
            drawSmoothLine(spyPriceHistory, '#ffd700', 3, true);
            
            // Title
            ctx.fillStyle = '#00d4ff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            const titleText = currentLang === 'es' ? 
                'Volumen Acumulado en Tiempo Real (√öltimas 2 Horas)' :
                'Real-Time Cumulative Volume (Last 2 Hours)';
            ctx.fillText(titleText, width / 2, padding - 30);
            
            // Axis labels
            ctx.fillStyle = '#888';
            ctx.font = '11px Arial';
            ctx.fillText(currentLang === 'es' ? 'Hora' : 'Time', width / 2, height - 10);
            
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('Net Premiums (Vol. Acumulado)', 0, 0);
            ctx.restore();
            
            ctx.save();
            ctx.translate(width - 15, height / 2);
            ctx.rotate(Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillStyle = '#ffd700';
            ctx.fillText('SPY Price', 0, 0);
            ctx.restore();
            
            // Current values box
            const latestCall = callVolumeHistory[callVolumeHistory.length - 1];
            const latestPut = putVolumeHistory[putVolumeHistory.length - 1];
            const latestSpy = spyPriceHistory[spyPriceHistory.length - 1];
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(width - paddingRight - 180, padding + 10, 170, 80);
            
            ctx.font = 'bold 11px Arial';
            ctx.textAlign = 'left';
            
            ctx.fillStyle = '#00ff88';
            ctx.fillText('CALLs: ' + (latestCall / 1000000).toFixed(1) + 'M', width - paddingRight - 170, padding + 28);
            
            ctx.fillStyle = '#ff0064';
            ctx.fillText('PUTs: ' + (latestPut / 1000000).toFixed(1) + 'M', width - paddingRight - 170, padding + 48);
            
            ctx.fillStyle = '#ffd700';
            ctx.fillText('SPY: $' + latestSpy.toFixed(2), width - paddingRight - 170, padding + 68);
            
            const netFlow = latestCall + latestPut;
            ctx.fillStyle = netFlow > 0 ? '#00ff88' : '#ff0064';
            ctx.fillText('Net: ' + (netFlow / 1000000).toFixed(1) + 'M', width - paddingRight - 170, padding + 83);
        }

        function updateData() {
            const newTime = new Date();
            timeLabels.shift();
            timeLabels.push(newTime);
            
            const lastCall = callVolumeHistory[callVolumeHistory.length - 1];
            const lastPut = putVolumeHistory[putVolumeHistory.length - 1];
            const lastSpy = spyPriceHistory[spyPriceHistory.length - 1];
            
            callVolumeHistory.shift();
            callVolumeHistory.push(lastCall + 150000 + Math.random() * 200000);
            
            putVolumeHistory.shift();
            putVolumeHistory.push(lastPut - 100000 - Math.random() * 150000);
            
            spyPriceHistory.shift();
            spyPriceHistory.push(lastSpy + (Math.random() - 0.5) * 0.3);
            
            drawChart();
        }

        setInterval(updateData, 2000);
        window.addEventListener('resize', drawChart);
    </script>
</body>
</html>
